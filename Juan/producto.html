<!DOCTYPE html>
<html lang="es">

<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Producto - ChemiStore</title>
  <meta name="descripcion-page"
    content="Somos una p√°gina de tienda de camisetas de f√∫tbol, creada con la intenci√≥n de hacer llegar lo mejor hasta tu hogar y unirnos como lo que somos, dentro y fuera de la cancha una familia." />
  <link rel="StyleSheet" href="estilos.css" type="text/css" media="screen" />
  <script src="code.js"></script>
  <script src="https://kit.fontawesome.com/b20a70b737.js" crossorigin="anonymous"></script>
</head>

<body>
  <div class="btn-arriba">
    <a href="index.html">
      <i class="fa-solid fa-arrow-up"></i>
    </a>
  </div>

  <header>
    <img src="/imagenes/logo-sf1.png" alt="logo sin fondo en el header" />
    <h2>Categor√≠as de nuestros productos</h2>

    <div class="btn-carrito">
      <a href="carrito.html">
        <i class="fa-solid fa-cart-shopping"></i>
      </a>
    </div>

    <div class="categorias">
      <nav class="navegacion">
        <div class="categoria-item">
          <a href="index.html?category=1" class="categoria-texto" data-category="1">Retro</a>
          <div class="categoria-imagen">
            <img src="/imagenes/retro.png" alt="Camiseta retro" />
          </div>
        </div>

        <div class="categoria-item">
          <a href="index.html?category=2" class="categoria-texto" data-category="2">Actualidad</a>
          <div class="categoria-imagen">
            <img src="/imagenes/actualidad.png" alt="Camiseta actualidad" />
          </div>
        </div>

        <div class="categoria-item">
          <a href="index.html?category=3" class="categoria-texto" data-category="3">Ni√±os</a>
          <div class="categoria-imagen">
            <img src="/imagenes/ni√±o1.png" alt="Camiseta ni√±o" />
          </div>
        </div>

        <div class="categoria-item">
          <a href="index.html?category=4" class="categoria-texto" data-category="4">Hombre</a>
          <div class="categoria-imagen">
            <img src="/imagenes/hombre1.png" alt="Camiseta hombre" />
          </div>
        </div>

        <div class="categoria-item">
          <a href="index.html?category=5" class="categoria-texto" data-category="5">Mujer</a>
          <div class="categoria-imagen">
            <img src="/imagenes/mujer.png" alt="Camiseta mujer" />
          </div>
        </div>
      </nav>
    </div>
  </header>

  <main id="producto-detalle">

  </main>

  <footer>
    <div class="contenedor-img1">
      <img src="/imagenes/logo-sf1.png" alt="logo sin fondo en footer" />
    </div>

    <div class="footer-content">
      <div class="footer-column">
        <h3>Contacto</h3>
        <ul>
          <li>
            <strong>E-mail:</strong>
            <a href="https://accounts.google.com/">chemistore.sv@gmail.com</a>
          </li>
          <li><strong>Tel√©fono:</strong> +503 1234-5678</li>
          <li>
            <strong>Direcci√≥n:</strong> Avenida Cuscatl√°n y 2¬∞ Calle Poniente,
            local #34, San Salvador, El Salvador
          </li>
        </ul>
      </div>

      <div class="footer-column">
        <h3>Enlaces</h3>
        <ul>
          <li><a href="index.html">Inicio</a></li>
          <li><a href="quiensomos.html">Sobre Nosotros</a></li>
          <li><a href="carrito.html">Carrito</a></li>
          <li><a href="opinion.html">Danos tu opini√≥n</a></li>
        </ul>
      </div>

      <div class="footer-column">
        <h3>Siguenos</h3>
        <ul class="footer-icons">
          <li>
            <a href="https://facebook.com" target="_blank"><i class="fab fa-facebook"></i></a>
          </li>
          <li>
            <a href="https://instagram.com" target="_blank">
              <i class="fab fa-instagram"></i></a>
          </li>
          <li>
            <a href="https://www.tiktok.com/signup" target="_blank">
              <i class="fab fa-tiktok"></i></a>
          </li>
          <li>
            <a href="https://x.com" target="_blank">
              <i class="fab fa-twitter"></i></a>
          </li>
        </ul>
      </div>
    </div>
    <p>Desarrollado por: Urrutia Najarro, Juan Jos√©</p>
    <p>Carnet: UN22001</p>
  </footer>

<script>
  document.addEventListener('DOMContentLoaded', function () {
    const urlParams = new URLSearchParams(window.location.search);
    const productId = Number(urlParams.get('id'));
    const apiBase = `${window.location.origin}/code`;

    if (productId) {
      Promise.all([
        fetch(`${apiBase}/camisetas`).then(res => res.json()),
        fetch(`${apiBase}/tallas`).then(res => res.json())
      ])
        .then(([camisetas, tallas]) => {
          const producto = camisetas.find(p => p.id == productId);

          if (producto) {
            const tallasIds = Array.isArray(producto.talla) ? producto.talla : [producto.talla];
            const tallasDisponibles = tallasIds
              .map(id => tallas.find(t => t.id == id)?.nombre)
              .filter(Boolean);

            const main = document.getElementById('producto-detalle');
            main.innerHTML = `
          <div class="producto-container">
            <div class="producto-imagen">
              <img src="${producto.img}" alt="${producto.nombre}">
            </div>
            <div class="producto-info">
              <h3>${producto.nombre}</h3>
              <p>${producto.descripcion}</p>
              <p class="precio">$${producto.precio}</p>
              <label for="talla-select">Talla:</label>
              <select id="talla-select">
                ${tallasDisponibles.map(t => `<option value="${t}">${t}</option>`).join('')}
              </select>
              <label for="cantidad-input">Cantidad:</label>
              <input type="number" id="cantidad-input" min="1" value="1">
              <button id="agregar-carrito">Agregar al Carrito</button>
            </div>
          </div>
        `;

            document.getElementById('agregar-carrito').addEventListener('click', function () {
              const talla = document.getElementById('talla-select').value;
              const cantidad = parseInt(document.getElementById('cantidad-input').value);

              if (cantidad < 1) {
                alert('Por favor ingrese una cantidad v√°lida.');
                return;
              }

              let cart = JSON.parse(localStorage.getItem('cart')) || [];
              const existingItem = cart.find(item => item.id === producto.id && item.talla === talla);

              if (existingItem) {
                existingItem.cantidad += cantidad;
              } else {
                cart.push({
                  id: producto.id,
                  nombre: producto.nombre,
                  img: producto.img,
                  precio: producto.precio,
                  talla: talla,
                  cantidad: cantidad
                });
              }

              localStorage.setItem('cart', JSON.stringify(cart));

              // üîπ NUEVO: tambi√©n guardar el pedido en el JSON del servidor
              fetch(`${apiBase}/pedidos`, {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify({
                  idProducto: producto.id,
                  nombre: producto.nombre,
                  img: producto.img,
                  precio: producto.precio,
                  talla: talla,
                  cantidad: cantidad,
                  fecha: new Date().toISOString()
                })
              })
                .then(res => {
                  if (!res.ok) throw new Error('Error al guardar el pedido en el JSON');
                  return res.json();
                })
                .then(() => {
                  alert('Producto agregado al carrito y guardado en pedidos');
                })
                .catch(err => {
                  console.error('Error al guardar el pedido:', err);
                  alert('Producto agregado al carrito, pero no se pudo guardar en pedidos');
                });
            });
          } else {
            document.getElementById('producto-detalle').innerHTML = '<p>Producto no encontrado.</p>';
          }
        })
        .catch(error => {
          console.error('Error fetching data:', error);
          document.getElementById('producto-detalle').innerHTML = '<p>Error al cargar los datos del producto.</p>';
        });
    } else {
      document.getElementById('producto-detalle').innerHTML = '<p>ID de producto no especificado.</p>';
    }
  });
</script>



</body>

</html>